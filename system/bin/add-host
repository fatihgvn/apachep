#!/bin/bash

# Arguments
# add-host [domain] [port] [phpversion]

domain=$1
path=/var/www/$domain
port=80
phpversion=7.2

if [ $# -eq 2 ]
then
  port=$2
fi

if [ $# -eq 3 ]
then
  port=$2
  phpversion=$3
fi

echo $domain $port $phpversion

/var/www/html/system/bin/create-conf $domain $port $phpversion

if [ ! -d "$path" ]
then
  mkdir $path
  mkdir $path/public_html
  mkdir $path/logs
  mkdir $path/temp
  mkdir $path/ssl
  mkdir $path/backups

  cp -R /var/www/html/system/templates/public_html/* $path/public_html

  chown -R $SUDO_USER $path
  chgrp -R www-data $path
  chmod g+s $path

  /var/www/html/system/bin/create-ssl $domain
fi

echo "127.0.0.1       $domain www.$domain" >> /etc/hosts

systemctl restart apache2.service
