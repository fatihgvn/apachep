#!/bin/bash

# Arguments
# add-host [domain] [phpversion]

domain=$1
path=/var/www/$domain
port=80
phpversion=7.4

if [ $# -eq 2 ]
then
  phpversion=$2
fi

echo $domain $port $phpversion

a-create-conf $domain $phpversion

if [ ! -d "$path" ]
then
  mkdir $path
  mkdir $path/public_html
  mkdir $path/logs
  mkdir $path/temp
  mkdir $path/ssl
  mkdir $path/backups

  cp -R /var/www/html/system/templates/public_html/* $path/public_html

  chown -R $SUDO_USER $path
  chgrp -R www-data $path
  chmod g+s $path

  a-create-ssl $domain
fi

echo "127.0.0.1       $domain www.$domain" >> /etc/hosts

a2ensite $domain.conf

systemctl restart apache2.service
